@@define DBDIR /var/lib/aide
@@define LOGDIR /var/log/aide

# Database and report locations
database=file:@@{DBDIR}/aide.db
database_out=file:@@{DBDIR}/aide.db.new
report_url=file:@@{LOGDIR}/aide.log
report_url=syslog:LOG_LOCAL6

# Custom rule definitions for different file types
# p = permissions, i = inode, n = number of links, u = user, g = group
# s = size, b = block count, m = mtime, a = atime, c = ctime
# S = check for growing size, acl = access control lists
# selinux = SELinux security context, xattrs = extended attributes
# sha256 = SHA256 checksum, sha512 = SHA512 checksum

# Complete checking (for critical system files)
CRITICAL = p+i+n+u+g+s+b+m+c+sha512+acl+selinux+xattrs

# Binary files (executables)
BINARIES = p+i+n+u+g+s+b+m+c+sha512

# Configuration files (may change, but we want to know)
CONFIGS = p+u+g+s+b+m+c+sha512

# Log files (size and mtime can change, but not content retroactively)
LOGS = p+u+g+s+b+m+c+sha512

# Database files (can grow)
DATAFILES = p+u+g+n+S+acl+selinux+xattrs

# Read-only files (application code)
READONLY = p+i+n+u+g+s+b+m+c+sha512+acl+selinux+xattrs

# =========================================
# CRITICAL SYSTEM FILES
# =========================================

# System binaries
/bin BINARIES
/sbin BINARIES
/usr/bin BINARIES
/usr/sbin BINARIES
/usr/local/bin BINARIES
/usr/local/sbin BINARIES

# System libraries
/lib BINARIES
/lib64 BINARIES
/usr/lib BINARIES
/usr/lib64 BINARIES

# Boot files
/boot CRITICAL

# System configuration
/etc CONFIGS
!/etc/mtab
!/etc/adjtime
!/etc/lvm/cache
!/etc/lvm/backup
!/etc/lvm/archive

# PAM and security
/etc/pam.d CRITICAL
/etc/security CRITICAL
/etc/ssh CRITICAL
/etc/sudoers CRITICAL
/etc/sudoers.d CRITICAL

# =========================================
# OPENGRC APPLICATION FILES
# =========================================

# Application code (should not change in production)
/var/www/html/app READONLY
/var/www/html/bootstrap READONLY
/var/www/html/config CONFIGS
/var/www/html/database READONLY
/var/www/html/public READONLY
/var/www/html/resources READONLY
/var/www/html/routes READONLY

# Composer files
/var/www/html/composer.json CONFIGS
/var/www/html/composer.lock CONFIGS
/var/www/html/vendor READONLY

# Environment configuration (CRITICAL - contains secrets)
/var/www/html/.env CRITICAL

# Artisan and other entry points
/var/www/html/artisan READONLY

# Package configuration
/var/www/html/package.json CONFIGS
/var/www/html/package-lock.json CONFIGS
/var/www/html/node_modules READONLY

# =========================================
# WEB SERVER CONFIGURATION
# =========================================

# Apache configuration
/etc/apache2 CONFIGS
!/etc/apache2/sites-enabled/000-default.conf

# PHP configuration
/etc/php CONFIGS

# =========================================
# SECURITY & MONITORING
# =========================================

# AIDE itself
/etc/aide CRITICAL
/usr/bin/aide CRITICAL
/usr/sbin/aide CRITICAL

# Cron jobs
/etc/cron.d CRITICAL
/etc/cron.daily CRITICAL
/etc/cron.hourly CRITICAL
/etc/cron.weekly CRITICAL
/etc/cron.monthly CRITICAL
/etc/crontab CRITICAL
/var/spool/cron CRITICAL

# Systemd services
/etc/systemd/system CRITICAL
/lib/systemd/system CRITICAL

# =========================================
# EXCLUSIONS
# =========================================

# Temporary and cache directories
!/var/www/html/storage/app
!/var/www/html/storage/framework/cache
!/var/www/html/storage/framework/sessions
!/var/www/html/storage/framework/views
!/var/www/html/storage/logs
!/var/www/html/bootstrap/cache

# System temporary files
!/tmp
!/var/tmp
!/var/cache
!/var/lock
!/var/run
!/var/spool
!/proc
!/sys
!/dev
!/run

# Log files (monitored separately)
!/var/log

# Database files (can change frequently)
!/var/lib/aide/aide.db
!/var/lib/aide/aide.db.new
!/var/www/html/database/database.sqlite
!/var/www/html/database/database.sqlite-shm
!/var/www/html/database/database.sqlite-wal

# Fluent Bit storage
!/tmp/flb-storage
!/tmp/flb_*.db

# User home directories (not part of system integrity)
!/home
!/root/.bash_history
!/root/.cache
!/root/.local

# Package manager caches
!/var/lib/apt
!/var/lib/dpkg

# =========================================
# CUSTOM RULES
# =========================================

# Monitor Laravel artisan console
/var/www/html/artisan CRITICAL

# Monitor Filament panel providers (core security)
/var/www/html/app/Providers CRITICAL

# Monitor middleware (authentication/authorization)
/var/www/html/app/Http/Middleware CRITICAL

# Monitor Filament resources (access control)
/var/www/html/app/Filament READONLY

# Monitor database migrations (schema changes)
/var/www/html/database/migrations CRITICAL
